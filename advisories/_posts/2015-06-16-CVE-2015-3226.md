---
layout: advisory
title: 'CVE-2015-3226 (activesupport): XSS Vulnerability in ActiveSupport::JSON.encode

'
comments: false
categories:
- activesupport
- rails
advisory:
  gem: activesupport
  framework: rails
  cve: 2015-3226
  url: https://groups.google.com/forum/#!topic/ruby-security-ann/7VlB_pck3hU
  title: 'XSS Vulnerability in ActiveSupport::JSON.encode

'
  date: 2015-06-16
  description: "When a `Hash` containing user-controlled data is encode as JSON (either
    through \n`Hash#to_json` or `ActiveSupport::JSON.encode`), Rails does not perform
    adequate \nescaping that matches the guarantee implied by the `escape_html_entities_in_json`
    \noption (which is enabled by default). If this resulting JSON string is subsequently
    \ninserted directly into an HTML page, the page will be vulnerable to XSS attacks.
    \n\nFor example, the following code snippet is vulnerable to this attack: \n\n
    \   <%= javascript_tag \"var data = #{user_supplied_data.to_json};\" %> \n\nSimilarly,
    the following is also vulnerable: \n\n    <script> \n      var data = <%= ActiveSupport::JSON.encode(user_supplied_data).html_safe
    %>; \n    </script> \n\nAll applications that renders JSON-encoded strings that
    contains user-controlled \ndata in their views should either upgrade to one of
    the FIXED versions or use \nthe suggested workaround immediately. \n\nWorkarounds
    \n----------- \nTo work around this problem add an initializer with the following
    code: \n\n  module ActiveSupport \n    module JSON \n      module Encoding \n
    \       private \n        class EscapedString \n          def to_s \n            self
    \n          end \n        end \n      end \n    end \n  end \n"
  unaffected_versions:
  - "< 4.1.0"
  patched_versions:
  - ">= 4.2.2"
  - "~> 4.1.11"
---
